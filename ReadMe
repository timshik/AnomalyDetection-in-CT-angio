we took healthy scans, mask them with rate (0<rate<1) and then tried to reconstruct them

for rate = 0.2 the reconstruction is almost perfect
when the trained model were given with healthy scans without mask, he again reconstructed them almost perfectly (left the scan as it is, see in 'test' folder)

further thoughts

there are few approaches we can take now

1) we can give the model scans with distal clot and hope that he will see the clot as mask, therefore he will reconstruct the scan without the clot
then we can take the difference between the original and the created and find the clot.

2) we can give the model the scans with distal clot, only this time we will mask it,
hopefully the model won't reconstruct the clot (its an anomaly that he not suppose to be aware of).
here we can play with the rate variable, the bigger it is the more blank pixels will appear in the scan,
and so the model will have more pixels to reconstruct which might harden the task to reconstruct the clot ( we dont want the model to succeed reconstruct the clot)

3) we can try to apply some simpler anomaly detection algorithm on the latent variable (the result of the encoder ) that we got
hoping that the model encoded enough information on the scan in that variable to differentiate normal scans from anomaly scans (distal clot)
again here we can play with the mask rate, the bigger it is the model will have to understand the architecture of the scan better,
and hopefully create better representation for the scans.


### we can use other scans (or maybe combining ) for that task ( like parenchyma ) so the clot will be bold, and it will be hard for the model to reconstruct the right color
### for now we are working with downscaled version of the scans, because its time consuming working with the 1024X1024 version.


ניסתי עם MASK = 0.5
המודל ידע להשלים בצורה טובה מדי את החסר ולכן לא השלים את הענפים החסומים
עבור 0.8 המודל עדיין הצליח להשלים מספיק טוב את החלקים החסרים, עם קצת רעש. עדיין זה לא היה מספיק בשביל להשלים את הענפים החסומים.
עבור 0.95 המודל ייצר פשוט רעש
אפשר לנסות לקחת ערך בין 0.95 ל 0.8 אבל כניראה שכל עוד המודל יצליח לשחזר הוא ידע לא לשחזר את הכלים החסומים.
כניראה שמה שהוא לומד לעשות זה מעין ממוצע של הפיקסלים מסביב לפיקסלים החסרים ולכן כל עוד הוא יש לו מספיק מידע מסביב לפיקסל החסר הוא ישלים אותו בצורה טובה מדי (לא ינסה להשלים את הענף החסום)
לכן אולי כדאי להתחיל להסתיר סביבה שלמה וכך המודל יצטרך ללמוד יותר מאשר לעשות ממוצע פיקסלים מסביב לנקודה
ניתן לשחק עם גודל הסביבה שאנחנו מחסירים ועם כמות הסביבות שאנחנו מחסירים. ניתן גם לעשות את ההשלמה עם היסטוגרמות כמו 8200

כשניסיתי לשים קוביות יותר גדולות(50X50)

על ה TEST ולהשתמש בשחזור שנלמד על הפיקסלים הבודדים אפשר לראותש המודל לא מצליח לשחזר ומשאיר את הריבועים הלבנים בעינם (פרט לקצת גוון אפרפר) כלומר אכן אפשר לראות שהמודל פשוט למד לעשות ממוצע על הפיקסל החסרת לכן הפיקסלים שנמצאים באמצע נשארו כמעט לבנים (הם מיצוע של פיקסלים לבנים ) והפיקסלים בפינות קיבלו גוון אפרפר מהפיקסלים מחות לריבוע
בסריקות שלנו ההבדל בעוצמה בין פיקסלים דומים הוא נמוך יחסית ולכן כניראה השטה הזאת לא עובדת

עד לכאן הניסוי הראשון צריך למספר אותו לפי  (?).1
2.1
ניסיתי לעשות ריבועים בגודל 50X50 בהסתברות 0.0001 ניתן לראות שהמודל משחזר בצורה טובה עורקים שהוא רואה את ההתחלה ואת הסוף שלהם, אך לא מצליח לשחזר ורידים שהוא רואה רק את ההתחלה שלהם, בנוסף הוא מצליח לשחזר עורקים שהקונטרסט שלהם חזק (כלומר הם יותר שחורים כנגד הרקע הלבן ) לעומת זאת הוא לא מצליח טוב כאשר העורק צבוע חלש (עורקים דיסטאליים ), גם בישחזורים הטובים המודל עושה את זה די מרוח, כלומר הוא עושה מיצוע כל שהוא על הצבעים, והוא יודע להשלים רק את הרקע בצורה מושלמת 

אפשר שלראות את התוצאות בתיקייה 2.1 

מכאן יש לנו כמה אפשרויות להתקדם 
1) להקטין את הריבועים: אולי הריבועים גדולים מדי ולכן אין לו מספיק קונטקסט כדי למלא אותם 
2) להקטין את מספר הריבועים: יכול להיות שיותר מדי חלקים מהתמונה מוסתרים ולכן הוא לא מצליח לשחזר מספיק טוב 
3) להחליף את הצבעים בתמונה: כלומר img-i255 בצורה כזאת ערכי הפיקסלים שמייצגים את התמונה יהיו יותר גבוהים ולא שואפים ל 0 כמו עכשיו 
4) טרנספורמציה של כל הצבעים למספר צבעים קטן וקבוע: אין לנו צורך בכל סרגל הצבעים מ 0-255 המידע בתמונה הוא בינארי (יש עורק\ אין עורק) מכיוון שמאוד קשה למצוא את הסף שיפריד בין הרקע לעורקים הדיסטאליים, אפשר להפוך את התמונה לכמה צבעים, בנוסף אפשר לנסות לנרמל את התמונה כדי שהערכים יהיו בין חצי למינוס חצי 
5) אני פחות בטוח בכיוון הזה, אולי לנסות להפוך את המאסקים לפחות בולטים, כלומר שיהיה להם צבע של הרקע, בצורה כזאת המודל יצטרך לדעת עבור כל נקודה ברקע האם אמור לעבור שם עורק או לא אמור לעבור שם עורק, ולא רק בקוביות הלבנות. בנוסף זה יכול לעזור למודל עם הרעש של הריבוע הלבן. אם המודל יצליח ללמוד בצורה טובה איך להשלים מסיכות כאלה אולי הוא יוכל להשלים חסימות בתמונה של מטופל חולה ללא מסיכות.
6) לנסות לחזות היסטוגרמות במקום לנסות לשחזר את התמונה

נניח שהמודל הצליח להשלים בצורה טובה את ה קוביות, איך ניתן ציון לתחזית ? 
אפשר להעביר את הקוביה על כל התמונה ולחפש את הקוביה שבה הוא יש שוני גדול בין מה שהוא חזה למקור.

2.2
הורדתי את הקוביה ל 25X25 אפשר לראות שהשחזור משמעותית יותר טוב כעת, כדי להעריך האם המודל יודע לשחזר כרישים צריך לרשום את הסקריפט שמריץ קוביה על כל הסריקה ובכל נקודה בודק האם המודל שחזר את הקוביה בצורה טובה.
